#!/bin/zsh

_ymt_checkip_usage() {
  cat <<EOF
checkip displays the current IP address of the PC.

Usage:
    checkip        show your IP Address on AWS/GCP
    checkip aws    show your IP Address on AWS
    checkip gcp    show your IP Address on GCP

Options:
    --help, -h        print help
EOF
}

case ${1} in
  -h|--help)
    _ymt_checkip_usage
  ;;

  aws)
    curl -sS --max-time 10 https://checkip.amazonaws.com/ || echo "Error: Failed to get IP from AWS" >&2
  ;;

  gcp)
    curl -sS --max-time 10 https://domains.google.com/checkip || echo "Error: Failed to get IP from GCP" >&2
  ;;

  *)
    local aws_ip gcp_ip
    aws_ip=$(curl -sS --max-time 10 https://checkip.amazonaws.com/ 2>/dev/null || echo "Error")
    gcp_ip=$(curl -sS --max-time 10 https://domains.google.com/checkip 2>/dev/null || echo "Error")
    echo "AWS: $aws_ip"
    echo "GCP: $gcp_ip"
  ;;
esac

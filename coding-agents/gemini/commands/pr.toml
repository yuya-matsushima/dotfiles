description = "Create a high-quality GitHub Pull Request (use [base-branch] [--auto])"

prompt = """
## Arguments
{{args}}

## Base Branch Determination

1. **Parse arguments**:
   - Check for "--auto" flag
   - Extract base branch (first non-flag argument from arguments):
     - Remove "--auto" from arguments to get the branch name
     - If branch name is specified, validate: `git rev-parse --verify <branch> 2>/dev/null`
     - If branch doesn't exist, display: "Branch '<branch>' not found. Use default detection? (y/n)"
     - If user declines (n), exit without creating PR

2. **Auto-detect if no branch name is specified**:
   - First, check upstream tracking branch: `git rev-parse --abbrev-ref @{upstream} 2>/dev/null`
     - If exists and is a remote tracking branch (e.g., `origin/feature/big-feature`), extract the branch name by removing the remote prefix (`origin/` → `feature/big-feature`)
     - Verify the extracted branch exists locally: `git rev-parse --verify <branch> 2>/dev/null`
     - If valid, use it as base branch
   - Fallback: Try in order: develop → main → master
   - Use first that exists via: `git rev-parse --verify <branch_name> 2>/dev/null`
   - If none exist, show error: "Error: No default base branch found (tried: upstream, develop, main, master). Please specify a base branch explicitly: pr <base-branch> [--auto]" and exit

3. **Result**:
   - Remember the determined base branch name (e.g., `main`, `develop`) for use in subsequent steps.
   - **Important**: Do not assume shell variables (like `$BASE_BRANCH`) persist between commands. Use the actual branch name explicitly.

## Instructions

1. **Auto mode detection**: Check if the arguments contain "--auto" flag.

2. **Analyze Current Changes**:
   - Run `git diff <base_branch>...HEAD` (replace `<base_branch>` with the actual determined branch name)
   - Run `git log <base_branch>...HEAD --oneline` to review the commit history and understand the context

3. **Context Check**: Look for an `AGENTS.md` file in the root directory.

4. **Language Selection for PR**:
   - IF `AGENTS.md` contains specific language rules for PR (English specification), follow them.
   - ELSE (or if no specific rules are found), use **Japanese** as the default language for PR title and body.

5. **Draft PR Content**:
   - **Title**: Create a concise, descriptive title following Conventional Commit format
     - Examples (Japanese): `feat: ユーザー認証機能を追加`, `fix: ログイン時のバグを修正`
     - Examples (English): `feat: add user authentication logic`, `fix: resolve login bug`
   - **Body**: Write a professional PR description in Markdown. Include:
     - **Summary**: What does this PR do? (1-2 sentences)
     - **Key Changes**: Bullet points of technical changes
     - **Impact**: Any potential side effects or areas to review

6. **Execution Logic**:
   - **If arguments contain "--auto"**:
     - Execute: `git push origin HEAD` to push the current branch
     - Execute: `gh pr create --title "[Generated Title]" --body "[Generated Body]" --assignee @me` to create the PR
     - Display the final PR URL and summary of what was done
   - **Otherwise (Interactive mode)**:
     - Display the drafted PR title and body
     - Show the exact commands that would be executed:
       ```
       git push origin HEAD
       gh pr create --title "[Title]" --body "[Body]" --assignee @me
       ```
     - Ask: "このPRを作成しますか？ (y/n)" (or in English if applicable: "Do you want to create this PR? (y/n)")
     - If confirmed (y), execute the commands above
     - If denied (n), cancel without any changes
"""
